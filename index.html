<!DOCTYPE html>
<!--[if lt IE 7]>	<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>		<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>		<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
		<title>Rhinoforms</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width">
		<link rel="stylesheet" type="text/css" href="forms/MM-interactive-merge/interactive-merge.css"/>
	</head>
	<body>

		<!--[if lt IE 7]>
			<p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
		<![endif]-->
		<div class="im-container">
			<div class="rhinoforms-merge-container merge-content"></div>
		</div>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
		<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.8.0.min.js"><\/script>')</script>
		<script type='text/javascript' src='js/rhinoforms.js' ></script>
		<script src="forms/MM-interactive-merge/js/im.js"></script>
		<script src="forms/MM-interactive-merge/js/im-preview.js"></script>
		<script src="forms/MM-interactive-merge/js/ckeditor/ckeditor.js"></script>
		<script type='text/javascript'>
			var rf = new Rhinoforms();
			var CKEDITOR_BASEPATH = 'forms/MM-interactive-merge/js/ckeditor/';
			var interactive_merge = new InteractiveMerge();
			var merge_preview = new IMPreview($('.im-container'), interactive_merge);

			function MM_interactive_merge() {
				var container = $('.rhinoforms-merge-container');
				var invalidJobMessage = 
					'<h2>Unable to initialise Interactive Merge</h2>\n\
					<p>A valid job ID has not been specified</p>';
				
				this.load = function(){
					var hashtag = window.location.hash;
					console.debug('hashtag: ' + hashtag);
					if (isValidId(hashtag)) {
						hashtag = hashtag.substr(1);
						initIM(hashtag, container);
					} else {
						this.setContent(invalidJobMessage);
					}
				}

				this.setContent = function(content){
					container.html(content);
				}
				
				function isValidId(str){
					var pattern = /^#[0-9]+$/g;
					return str.length > 1 && pattern.test(str);
				}
				
				function initIM(id, $container){
					loadMergeFlow(id, $container);
				}
			
				function loadMergeFlow(id, $container){
					var initialData = '<merge><jobId>' + id + '</jobId></merge>';
					var flow = 'forms/MM-interactive-merge/merge-flow.js';
					rf.loadFlow(flow, $container, initialData);
				}

				return this;
			}
			new MM_interactive_merge().load();

		</script>
		<script type='text/javascript' src='js/rhinoforms-custom-types.js' ></script>
	
	</body>
</html>